name: build

on:
  push:
    tags:
      v*.*.*

jobs:
  create-release:
    uses: JovialKnoll/workflows/.github/workflows/create-release.yml

  build-python:
    uses: JovialKnoll/workflows/.github/workflows/build-python.yml
    needs: create-release
    with:
      project_name: chikkai
      upload_url: ${{ needs.create-release.outputs.upload_url }}

  upload-butler:
    needs: [create-release, build-python]
    uses: JovialKnoll/workflows/.github/workflows/upload-butler.yml
    with:
      project_name: chikkai
      release_version: ${{ needs.create-release.outputs.release_version }}
      release_asset_url_ubuntu_latest: ${{ needs.build-python.outputs.release_asset_url_ubuntu_latest }}
      release_asset_url_macos_latest: ${{ needs.build-python.outputs.release_asset_url_macos_latest }}
      release_asset_url_windows_latest: ${{ needs.build-python.outputs.release_asset_url_windows_latest }}
    secrets:
      BUTLER_API_KEY: ${{ secrets.BUTLER_API_KEY }}
